<!doctype html>
<html lang="en">
  <head>
    <title>GGA - Projects</title>
    <base href="<%= base %>">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <script type="module" src="/src/scripts/main.ts"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <link rel="stylesheet" href="/src/styles/main.scss">
    <style>
      @font-face {
        font-family: 'Jost*';
        font-style: normal;
        font-weight: 200;
        src: url('assets/fonts/f0519003.woff2') format('woff2');
        font-display: swap;
      }

      @font-face {
        font-family: 'Jost*';
        font-style: normal;
        font-weight: 300;
        src: url('assets/fonts/512b8a76.woff2') format('woff2');
        font-display: swap;
      }

      @font-face {
        font-family: 'Jost*';
        font-style: normal;
        font-weight: 400;
        src: url('assets/fonts/ee4ca8b4.woff2') format('woff2');
        font-display: swap;
      }

      @font-face {
        font-family: 'Jost*';
        font-style: normal;
        font-weight: 600;
        src: url('assets/fonts/6b4bd741.woff2') format('woff2');
        font-display: swap;
      }

      * {
        box-sizing: border-box;
        font-family: 'Jost*', sans-serif;
      }

      [hidden] {
        display: none !important;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        background: #303030;
        color: #fff;
      }

      .material-symbols-outlined {
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <h1>Welcome to my projects homepage!</h1>
    <section id="filters" hidden>
      <label class="heading" for="filter-search">Search</label>
      <input name="filter-search" id="filter-search" class="material">
      <fieldset>
        <legend class="heading">Filter by language</legend>
        <ul id="languages" class="chips">
          <% const languages = Array.from(new Set(projects.flatMap(({ languages }) => languages))) %>
          <% languages.forEach(language => { %>
            <li class="checkable">
              <input type="checkbox" name="filter-language" id="filter-language-<%= language %>">
              <span class="material-symbols-outlined check">check</span>
              <label for="filter-language-<%= language %>"><%= language %></label>
            </li>
          <% }) %>
        </ul>
      </fieldset>
      <fieldset>
        <legend class="heading">Filter by library/framework</legend>
        <ul id="frameworks" class="chips">
          <% const frameworks = Array.from(new Set(projects.flatMap(({ frameworks = [] }) => frameworks))) %>
          <% frameworks.forEach(language => { %>
            <li class="checkable">
              <input type="checkbox" name="filter-framework" id="filter-framework-<%= language %>">
              <svg class="check" viewBox="0 0 24 24"><path d="M21 7 9 19l-5-5 1-2 4 4L20 6l1 1Z"/></svg>
              <label for="filter-framework-<%= language %>"><%= language %></label>
            </li>
          <% }) %>
        </ul>
      </fieldset>
      <fieldset>
        <legend class="heading">Filter by APIs technology/paradigm</legend>
        <ul id="frameworks" class="chips">
          <% const apiItems = Array.from(new Set(projects.flatMap(({ api = [] }) => api))) %>
          <% apiItems.forEach(apiItem => { %>
            <li class="checkable">
              <input type="checkbox" name="filter-framework" id="filter-framework-<%= apiItem %>">
              <svg class="check" viewBox="0 0 24 24"><path d="M21 7 9 19l-5-5 1-2 4 4L20 6l1 1Z"/></svg>
              <label for="filter-framework-<%= apiItem %>"><%= apiItem %></label>
            </li>
          <% }) %>
        </ul>
      </fieldset>
    </section>
    <ul id="projects">
      <%
        const iconFormatsExtensionsExceptions = {
          [ProjectIconFormat.PNG_PIXELATED]: 'png',
        };

        const iconFormatsMediaTypesExceptions = {
          [ProjectIconFormat.PNG_PIXELATED]: 'png',
          [ProjectIconFormat.SVG]: 'svg+xml',
          [ProjectIconFormat.JPEG]: 'jpeg',
        };

        const typeToActionMap = {
          [ProjectType.APP_WEB]: {
            icon: 'public',
            label: 'Visit',
          },
          [ProjectType.APP_CROSS_PLATFORM]: {
            icon: 'download',
            label: 'Download',
          },
          [ProjectType.APP_WINDOWS]: {
            icon: 'download',
            label: 'Download',
          },
          [ProjectType.BOT_TELEGRAM]: {
            icon: 'open_in_new',
            label: 'Launch',
          },
        };
      %>
      <% projects.forEach(({ id, name, description, link, source, type, languages, frameworks = [], api = [], icon }) => { %>
        <% const fallbackIconFormat = icon.formats.at(-1); %>
        <li id="project-<%= id %>">
          <div class="header">
            <picture>
              <% icon.formats.forEach(format => { %>
                <source
                  srcset="./assets/images/projects/<%= id %>.<%= iconFormatsExtensionsExceptions[format] || format %>"
                  type="image/<%= iconFormatsMediaTypesExceptions[format] || format %>"
                >
              <% }) %>
              <img
                <%- icon.formats.includes(ProjectIconFormat.PNG_PIXELATED) ? 'class="pixelated"' : '' %>
                style="background-image:url(&#34;<%- icon.placeholder %>&#34;);"
                src="./assets/images/projects/<%= id %>.<%= iconFormatsExtensionsExceptions[fallbackIconFormat] || fallbackIconFormat %>"
                width="128"
                height="128"
                alt="<%= name %>"
                title="<%= name %>"
                loading="lazy"
                lazyload
              >
            </picture>
            <ul class="chips scrollable">
              <% languages.forEach(language => { %>
                <li class="chip-language"><%= language %></li>
              <% }) %>
              <% frameworks.forEach(framework => { %>
                <li class="chip-framework"><%= framework %></li>
              <% }) %>
              <% api.forEach(apiItem => { %>
                <li class="chip-framework"><%= apiItem %></li>
              <% }) %>
            </ul>
            <h2><%= name %></h2>
          </div>
          <p><%= description %></p>
          <div class="actions">
            <% if (source) { %>
              <a href="<%= source %>" target="source-<%= id %>">
                <span class="material-symbols-outlined">code</span>
                <span>View source</span>
              </a>
            <% } %>
            <% if (link) { %>
              <a href="<%= link %>" target="link-<%= id %>">
                <% const { icon, label } = typeToActionMap[type] %>
                <span class="material-symbols-outlined"><%= icon %></span>
                <span><%= label %></span>
              </a>
            <% } %>
          </div>
        </li>
      <% }) %>
    </ul>
  </body>
</html>
